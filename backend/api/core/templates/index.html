{% extends "base.html" %}
{% load static %}

{% block title %}Index Page {% endblock %}

{% block content %}

<div class="d-flex justify-content-center align-items-center">   
    <div class="card" style="width: 39rem; background: linear-gradient(to right, #F9D1C4 0%, #9BBDDD 51%, #F9D1C4 100%);  border-radius: 15px; margin-bottom:30px;">
        <div class="card-body">
            <div class="row">
                <div class="col">
                    <div>
                        <form method="post" id="widget-form" class="widget-post__form" enctype="multipart/form-data" name="form" aria-label="post widget">
                            {% csrf_token %}
                            <div class="widget-post__content">
                            <textarea name="{{ form.content.name }}" id="post-content" class="widget-post__textarea scroller" placeholder="Start a Post...">{{ form.content.value|default:'' }}</textarea>
                            </div>
                            <div id="preview_image" style="display: none;">
                                <button type="button" class="close" onclick="handleOnDeletePhotoClick()" style="color: #00001c;">&times;</button>
                                <img class="card-img-top mb-2" src="#" />
                            </div>
                            <div class="widget-post__options is--hidden" id="stock-options">
                            </div>
                            <div class="widget-post__actions post--actions">
                                <div class="post-actions__attachments">
                                    <label for="upload-image" class="post-actions__label" onclick="handleOnPhotoClick()">
                                    <i class="fa fa-camera" sty aria-hidden="true"></i> 
                                    Photo
                                    </label>
                                    {{ form.image }}
                                    &nbsp; &nbsp; &nbsp; &nbsp;

                                    <label for="upload-image" class="post-actions__label">
                                        <i class="fa fa-video" aria-hidden="true"></i> 
                                    Video
                                    </label>
                                    &nbsp; &nbsp; &nbsp; &nbsp;

                                    <label for="upload-image" class="post-actions__label">
                                        <i class="fa fa-list-ul" aria-hidden="true"></i> 
                                    Poll
                                    </label>
                                </div>
                                <div class="post-actions__widget">
                                <button type="submit" class="btn post-actions__publish">Post</button>
                                </div>
                            </div>
                        </form>
                    </div> 
                </div>    
            </div>
        </div>
    </div>
</div>

{% for post in posts %}
<div class="d-flex justify-content-center align-items-center">
        <div class="card" style="width: 39rem; border-radius: 30px;margin:20px 0px 20px 0px;  overflow: hidden;background: linear-gradient(to right, #F9D1C4 0%, #9BBDDD 51%, #F9D1C4 100%);">
            <div class="card-body">
                    {% if post.reposts.all %}
                    {% for repost in post.reposts.all %}
                        <div class="repost-info">
                            Reposted by @{{ repost.user.username }}
                        </div>
                    {% endfor %}
                    {% endif %}
                <div class = "row">
                    <div class = "col-2">
                        {% if post.user.profile and post.user.profile.pic %}
                            <img src="{{ post.user.profile.pic.url }}" alt="{{ post.user.username }}'s profile picture" class="user-pic">
                        {% else %}
                            <img src="{% static 'default.jpg' %}" class="user-pic" alt="{{ post.user.username }}'s profile picture" />
                        {% endif %}
                    </div>
                    <div class="col-10">
                        <h5 class="card-title"><strong>@{{ post.user.username }}</strong></h5>
                        <p class="card-text">{{ post.content }}</p>
                    </div>
                </div>
                {% if post.image %}
                <img class="card-img-top mt-2" src="{{ post.image.url }}" alt="Post image" /><br><br>
                {% endif %}
                <h6 class="card-subtitle mb-2" style ="float: right; margin-top:5px;">{{ post.created_at|date:"M d, Y H:i" }}</h6>
                <br>
                <hr>
                <div class ="icons-list" >
                    <div class="feed" ><i class="fa fa-thumbs-up" aria-hidden="true"> Likes</i></div>
                    <div class="feed"> <i class="fa fa-comment" aria-hidden="true"> <a href="{% url 'comment' post_id=post.id %}">Comment</a></i> </div> 
                    <form method="post" action="{% url 'repost' post.id %}">
                        {% csrf_token %}
                        {% if post.id in reposted_post_ids %}
                            <div class="feed-reposted"><i class="fa fa-retweet" aria-hidden="true">  <button type="button" class = "reposted-button" disabled>Reposted</button></i> </div>
                        {% else %}
                        <div class="feed"><i class="fa fa-retweet" aria-hidden="true">  <button type="submit" class = "repost-button">Repost</button></i> </div>
                        {% endif %}
                    </form>
                    <div class="feed post-actions__label">
                        <i class="fa fa-flag" onclick="handleReportClick(this)" aria-hidden="true"> Report</i>
                        <input type="hidden" value="{{ post.id }}" />
                    </div>
                </div>
                   
                    
            </div>
        </div>
    </div>
</div>


{% empty %}
<li>No posts available. </li>
{% endfor %}

<div id="reportModal" class="popup">
    <div class="popup-content">
        <span class="close" onclick="handleReportClose()">&times;</span>
        <p class="modalTitle">Report</p>
        <form action="report/" method="POST">
            {% csrf_token %}
            {{ reportPostForm.post }}
            <label for="{{ reportPostForm.category.id_for_label }}" class="form-outline mb-4" style="font-size:20px;">Category</label>
            {{ reportPostForm.category }}
            <br>
            <label for="{{ reportPostForm.info.id_for_label }}" class="form-outline mb-4" style="font-size:20px;">Additional information</label>
            {{ reportPostForm.info }}
            <div class="text-md-right">
                <button class="saveButton">Report</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}