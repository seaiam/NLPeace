{% extends "base.html" %}
{% load static %}

{% block title %}Index Page {% endblock %}

{% block content %}

<script>

    const handleOnPhotoClick = () => {
        const upload = document.getElementById("id_image");
        upload.click();
    }

    const handleOnDeletePhotoClick = () => {
        const upload = document.getElementById("id_image");
        const div = document.getElementById("preview_image");
        const image = div.getElementsByTagName('IMG')[0];
        div.style.display = "none";
        image.src = "#";
        upload.value = null;
    }

</script>

<div class="row justify-content-center">   
    <div class="col-5">
        <div class="card" style="background: linear-gradient(to right, #F9D1C4 0%, #9BBDDD 51%, #F9D1C4 100%);  border-radius: 15px;">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <div>
                            <form method="post" id="widget-form" class="widget-post__form" enctype="multipart/form-data" name="form" aria-label="post widget">
                                {% csrf_token %}
                                <div class="widget-post__content">
                                <textarea name="{{ form.content.name }}" id="post-content" class="widget-post__textarea scroller" placeholder="Start a Post...">{{ form.content.value|default:'' }}</textarea>
                                </div>
                                <div class="widget-post__options is--hidden" id="stock-options">
                                </div>
                                <div class="widget-post__actions post--actions">
                                    <div class="post-actions__attachments">
                                        <label for="upload-image" class="post-actions__label" onclick="handleOnPhotoClick()">
                                        <i class="fa fa-camera" sty aria-hidden="true"></i> 
                                        Photo
                                        </label>
                                        {{ form.image }}
                                        &nbsp; &nbsp; &nbsp; &nbsp;

                                        <label for="upload-image" class="post-actions__label">
                                            <i class="fa fa-video" aria-hidden="true"></i> 
                                        Video
                                        </label>
                                        &nbsp; &nbsp; &nbsp; &nbsp;

                                        <label for="upload-image" class="post-actions__label">
                                            <i class="fa fa-list-ul" aria-hidden="true"></i> 
                                        Poll
                                        </label>
                                    </div>
                                    <div class="post-actions__widget">
                                    <button type="submit" class="btn post-actions__publish">Post</button>
                                    </div>
                                </div>
                                <div id="preview_image" class="widget-post___image">
                                    <img src="#" style="width: 100%; max-width: max-content; height: auto;"/>
                                    <label class="post-actions__label" onclick="handleOnDeletePhotoClick()"><i class="fa fa-trash"></i></label>
                                </div>
                            </form>
                        </div> 
                    </div>    
                </div>
            </div>
        </div>
        <div style="text-align: center; color: #D9D9D9">
            <h2>All posts</h2>
            <ul style="list-style-type: none;padding: 0;">
                {% for post in posts %}
                    <li>
                        {% if post.image %}
                        <div style="display:flex;justify-content:center;">
                            <img src="{{post.image.url}}" style="width: 100%; max-width: max-content; height: auto;" />
                        </div>
                        {% endif %}
                        {{ post.content }} @{{ post.user.username }} ({{ post.created_at|date:"F d, Y H:i" }})
                    </li>
                {% empty %}
                    <li>No posts available. </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<script>

    const upload = document.getElementById("id_image");
    const div = document.getElementById("preview_image");
    const image = div.getElementsByTagName("IMG")[0]
    upload.addEventListener('change', e => {
        const reader = new FileReader()
        if (e.target.files && e.target.files[0]) {
            reader.onload = () => {
                image.src = reader.result;
            };
            reader.readAsDataURL(e.target.files[0]);
            div.style.display = "flex";
        }
    });

</script>

{% endblock %}