{% extends "base.html" %}
{% load static %}

{% block title %}Index Page {% endblock %}

{% block content %}

<script>

    const handleOnPhotoClick = () => {
        const upload = document.getElementById("id_image");
        upload.click();
    }

    const handleOnDeletePhotoClick = () => {
        const upload = document.getElementById("id_image");
        const div = document.getElementById("preview_image");
        const image = div.getElementsByTagName('IMG')[0];
        upload.value = null;
        div.style.display = "none"; 
        image.src = "#";
    }

</script>

<div class="d-flex justify-content-center align-items-center">   
    <div class="card" style="width: 39rem; background: linear-gradient(to right, #F9D1C4 0%, #9BBDDD 51%, #F9D1C4 100%);  border-radius: 15px; margin-bottom:30px;">
        <div class="card-body">
            <div class="row">
                <div class="col">
                    <div>
                        <form method="post" id="widget-form" class="widget-post__form" enctype="multipart/form-data" name="form" aria-label="post widget">
                            {% csrf_token %}
                            <div id="preview_image" style="display: none;">
                                <button type="button" class="close" onclick="handleOnDeletePhotoClick()" style="color: #00001c;">&times;</button>
                                <img class="card-img-top mb-2" src="#" />
                            </div>
                            <div class="widget-post__content">
                            <textarea name="{{ form.content.name }}" id="post-content" class="widget-post__textarea scroller" placeholder="Start a Post...">{{ form.content.value|default:'' }}</textarea>
                            </div>
                            <div class="widget-post__options is--hidden" id="stock-options">
                            </div>
                            <div class="widget-post__actions post--actions">
                                <div class="post-actions__attachments">
                                    <label for="upload-image" class="post-actions__label" onclick="handleOnPhotoClick()">
                                    <i class="fa fa-camera" sty aria-hidden="true"></i> 
                                    Photo
                                    </label>
                                    {{ form.image }}
                                    &nbsp; &nbsp; &nbsp; &nbsp;

                                    <label for="upload-image" class="post-actions__label">
                                        <i class="fa fa-video" aria-hidden="true"></i> 
                                    Video
                                    </label>
                                    &nbsp; &nbsp; &nbsp; &nbsp;

                                    <label for="upload-image" class="post-actions__label">
                                        <i class="fa fa-list-ul" aria-hidden="true"></i> 
                                    Poll
                                    </label>
                                </div>
                                <div class="post-actions__widget">
                                <button type="submit" class="btn post-actions__publish">Post</button>
                                </div>
                            </div>
                        </form>
                    </div> 
                </div>    
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-center align-items-center">
        <div class="card" style="width: 39rem; border-radius: 30px;margin:20px 0px 20px 0px;  overflow: hidden;background: linear-gradient(to right, #F9D1C4 0%, #9BBDDD 51%, #F9D1C4 100%);">
            <div class="card-body">
                <div class = "row">
                    <div class = "col-2">
                        {% if post.user.profile and post.user.profile.pic %}
                            <img src="{{ post.user.profile.pic.url }}" alt="{{ post.user.username }}'s profile picture" class="user-pic">
                        {% else %}
                            <img src="{% static 'default.jpg' %}" class="user-pic" alt="{{ post.user.username }}'s profile picture" />
                        {% endif %}
                    </div>
                        <h5 class="card-title" style = "padding-bottom: 5%;">@{{ post.user.username }}</h5> 
                </div>
                {% if post.image %}
                <img class="card-img-top mt-2" src="{{ post.image.url }}" alt="Post image" />
                {% endif %}
                <p class="card-text">{{ post.content }}</p>
                <h6 class="card-subtitle mb-2" style ="float: right;">{{ post.created_at|date:"F d, Y H:i" }}</h6>
                <br>
                <hr>
                <div class ="icons-list" >
                    <div class="feed" ><i class="fa fa-thumbs-up" aria-hidden="true"> Likes</i></div>
                    <div class="feed"> <i class="fa fa-comment" aria-hidden="true"> Comment</i> </div> 
                    <div class="feed"><i class="fa fa-retweet" aria-hidden="true"> Repost</i> </div>
                </div>
            </div>
        </div>
</div>
        {% for reply in replies %}
        <div class="card" style="width: 39rem; border-radius: 30px;margin:20px 0px 20px 0px;  overflow: hidden;background: linear-gradient(to right, #F9D1C4 0%, #9BBDDD 51%, #F9D1C4 100%);">
            <div class="card-body">
                <div class = "row">
                    <div class = "col-2">
                        {% if reply.user.profile and reply.user.profile.pic %}
                            <img src="{{ reply.user.profile.pic.url }}" alt="{{ reply.user.username }}'s profile picture" class="user-pic">
                        {% else %}
                            <img src="{% static 'default.jpg' %}" class="user-pic" alt="{{ reply.user.username }}'s profile picture" />
                        {% endif %}
                    </div>
                        <h5 class="card-title" style = "padding-bottom: 5%;">@{{ reply.user.username }}</h5> 
                </div>
                {% if reply.image %}
                <img class="card-img-top mt-2" src="{{ reply.image.url }}" alt="reply image" />
                {% endif %}
                <p class="card-text">{{ reply.content }}</p>
                <h6 class="card-subtitle mb-2" style ="float: right;">{{ reply.created_at|date:"F d, Y H:i" }}</h6>
                <br>
                <hr>
                <div class ="icons-list" >
                    <div class="feed" ><i class="fa fa-thumbs-up" aria-hidden="true"> Likes</i></div>
                    <div class="feed"> <i class="fa fa-comment" aria-hidden="true"> <a href="{% url 'comment' post_id=reply.id %}">Comment</a></i> </div> 
                    <div class="feed"><i class="fa fa-retweet" aria-hidden="true"> Repost</i> </div>
                </div>
            </div>
        </div>
        {% endfor %}



<script>

    $(document).ready(() => {
        const upload = document.getElementById("id_image");
        const div = document.getElementById("preview_image");
        const image = div.getElementsByTagName("IMG")[0]
        upload.addEventListener('change', e => {
            const reader = new FileReader()
            if (e.target.files && e.target.files[0]) {
                reader.onload = () => {
                    image.src = reader.result;
                };
                reader.readAsDataURL(e.target.files[0]);
                div.style.display = "block";
            }
        });
    });

</script>

{% endblock %}